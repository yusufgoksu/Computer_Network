import socket
from response import handle_http_response_status  # Import your handler

def create_web_client(server_ip, server_port, path="/"):
    # Step 1: Create a TCP socket
    client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    try:
        # Step 2: Connect to the web server
        client_socket.connect((server_ip, server_port))
        print(f"Connection established: {server_ip}:{server_port}")

        # Step 3: Create an HTTP request (GET request)
        http_request = f"GET {path} HTTP/1.1\r\nHost: {server_ip}\r\nConnection: close\r\n\r\n"

        # Step 4: Send the HTTP request to the server
        client_socket.send(http_request.encode())
        print(f"HTTP request sent:\n{http_request}")

        # Step 5: Receive the HTTP response and print it
        response = b""  # Variable to store the response as bytes
        while True:
            data = client_socket.recv(4096)  # Receive data in 4 KB blocks
            if not data:
                break
            response += data

        #  Handle the HTTP status using the external function
        handle_http_response_status(response)

        print("----- Response from the server -----")
        print(response.decode(errors="ignore"))  # Print the full response

    except Exception as e:
        print(f"Connection error: {e}")

    finally:
        # Step 6: Close the socket
        client_socket.close()
        print("Connection closed.")

# Server IP address and port
server_ip = "127.0.0.1"  # Local server (localhost)
server_port = 80  # HTTP port

# Start the web client
create_web_client(server_ip, server_port, "/")  # Use "/" for the homepage
